var EventScripts=function(){var pub={init:function(){initDeviceCapture();initRegProgressNumbers();initShowDetails();EventScripts.initSubmitButtons()},initPaymentMethods:function(){$('.payment_method').on('click',function(){$('.payment-method-settings:visible').hide();var el=$('#'+$(this).val()+'_settings');el.find('.panel-body .billing_address').append($('.registrant-billing-address-div'));el.find('.panel-body .po_number').append($('.field-registrant-po_number'));el.fadeIn()})},initDeleteOrCancelReg:function(){$('.delete, .cancel').on('click',function(e){var btn=$(this);e.preventDefault();EventScripts.loadModal($(this).attr('href'),$(this).attr('title'),'',function(){$('.modal-footer').hide();$('.modal-content .deleteBtn, .modal-content .cancelBtn').one('click',function(){var widgetIds=getWidgetIds('.registration-check-alert');if(btn.hasClass('cancel')){widgetIds+=btn.closest('.widget').attr('id').replace('w_','')}
var form=$(this).closest('form');$.ajax({type:'POST',url:form.attr('action'),data:form.serialize()+'&refreshIds='+widgetIds,success:function(data){if(data.success){$('#swoogo-modal').modal('hide');if(btn.hasClass('delete')){btn.closest('tr').fadeOut(1000,function(){$(this).remove()})}
if(data.widgets){refreshWidgets(data.widgets)}}
if(data.redirect){window.location=data.redirect}},dataType:'json'})})})})},initTimezone:function(){$("#swoogo-modal form").on("beforeSubmit",function(){let widgetIds=getWidgetIds(".registrant-timezone-update");$.ajax({type:"POST",url:$(this).attr("action"),data:$(this).serialize(),success:function(data){if(data.success){$("#swoogo-modal").modal("hide");if(widgetIds){RegistrantInlineUpdates.reloadWidget(widgetIds)}}},dataType:"json"});return!1})},initEmailInvoice:function(){$('.email-invoice').on('click',function(e){e.preventDefault();EventScripts.loadModal($(this).attr('href'),$(this).attr('title'),'')})},initBookPasskey:function(){$('.book-in-passkey').on('click',function(e){e.preventDefault();EventScripts.loadModal($(this).attr('href'),$(this).attr('title'),'')})},initRegActionsButton:function(){var dropdownMenu;$('.registrant-dropdown').on('show.bs.dropdown',function(e){dropdownMenu=$(e.target).find('.dropdown-menu');$('body').append(dropdownMenu.detach());var eOffset=$(e.target).offset();dropdownMenu.css({'display':'block','top':eOffset.top+$(e.target).outerHeight(),'left':eOffset.left+$(e.target).outerWidth()-dropdownMenu.outerWidth()})});$(window).on('hide.bs.dropdown',function(e){$(e.target).append(dropdownMenu.detach());dropdownMenu.hide()})},initSubmitButtons:function(){var r_f=$('#registrant-form,#registrant-update-form,#cfs-form,#registrant-waitlist-form');r_f.on('beforeValidate',function(){$('input').on('keypress',disableEnter);$('button[type="submit"]').each(function(){EventScripts.disableButton($(this))});$('.nested-form').hide();$('#registrant-form .state-picker:visible, #registrant-update-form .state-picker:visible').each(function(){if($(this).val()&&!$(this).siblings('.state-text').val()){$(this).trigger('change')}})});r_f.on('afterValidate',function(event,messages,errorAttributes){if(errorAttributes.length>0){$('input').off('keypress',disableEnter);$('button[type="submit"]').each(function(){EventScripts.reEnableButton($(this))});$('.nested-form').show()}})},initOtherFormButtons:function(selector){let f=$(selector);f.on('beforeValidate',function(){$('input').on('keypress',disableEnter);$('button[type="submit"]').each(function(){EventScripts.disableButton($(this))})});f.on('afterValidate',function(event,messages,errorAttributes){if(errorAttributes.length>0){$('input').off('keypress',disableEnter);$('button[type="submit"]').each(function(){EventScripts.reEnableButton($(this))})}})},initPrintBadge:function(){$('.generate-badge').on('click',function(e){var el=$(this);$.ajax({type:'GET',url:el.attr('href'),success:function(data){if(data.loadModal){EventScripts.loadModal(data.badgeUrl,el.attr('title'),'',!0)}else{window.open(data.badgeUrl,'badge','height=400, width=400')}},dataType:'json'});e.preventDefault()})},loadModal:function(src,title,width,successFunc){var loader='<h4 class="text-center"><i class="fa fa-spin fa-spinner"></i> '+this.translate('Loading')+'</h4>',html='<div class="modal fade" id="swoogo-modal" tabindex="-1" role="dialog" aria-hidden="true">'+'<div class="modal-dialog '+(width==='large'?'modal-lg':'')+'">'+'<div class="modal-content">'+'<div class="modal-header">'+'<button type="button" class="close" data-dismiss="modal" role="button">x</button>'+'<h4 class="modal-title">'+(title?title:'&nbsp;')+'</h4>'+'</div>'+'<div class="modal-body content">'+loader+'</div>'+'<div class="modal-footer"><button type="button" class="btn btn-standard" data-dismiss="modal" role="button">'+this.translate('Close')+'</button></div>'+'</div>'+'</div>';if($('#swoogo-modal.modal').length===0){$('body').append(html);s_m=$('#swoogo-modal');s_m.on('hide.bs.modal',function(e){if($(e.target).prop('id')==='swoogo-modal'&&typeof oldRegistrantUpdateUrl!=='undefined'){registrantUpdateUrl=oldRegistrantUpdateUrl;oldRegistrantUpdateUrl=undefined}});s_m.on('hidden.bs.modal',function(e){if($(e.target).prop('id')==='swoogo-modal'){$('head').find('#modal-print-css').remove();$(this).find('.widget-api').trigger('hidden.pageWidget');$(e.currentTarget).attr(`tabindex`,`-1`)}});s_m.on('shown.bs.modal',function(e){if($(e.target).prop('id')==='swoogo-modal'){$('head').append($('<link href="/css/modal-print.css" rel="stylesheet" id="modal-print-css">'));if($('.arena-chat-widget--container').length){$(e.currentTarget).attr(`tabindex`,``)}}})}else{s_m=$('#swoogo-modal');s_m.find('.modal-title').html((title?title:'&nbsp;'));s_m.find('.modal-body').html(loader)}
s_m.find('.modal-body').loadWithJS(src).done(function(){if(typeof successFunc=="function"){successFunc()}
$(this).find('.widget-api').trigger('shown.pageWidget');s_m.off('scroll.modal').on('scroll.modal',()=>s_m.find('.aos-init:not(.aos-animate):in-viewport(-100)').addClass('aos-animate'))});s_m.modal({'show':!0,'backdrop':'static',})},modalTitle:function(title){let t=$('#swoogo-modal .modal-title');if(title&&t.html()==='&nbsp;'){t.html((title?title:'&nbsp;'))}},cookieCheck:function(){if(window.location!==window.parent.location){if(!navigator.cookieEnabled){EventScripts.loadModal('/frontend/registrant/disabled-cookies?iframe=1&lang='+$('html').attr('lang'))}else{$.ajax({type:"POST",url:'/frontend/registrant/disabled-cookies',data:{_csrf:yii.getCsrfToken()},dataType:'json',error:function(){EventScripts.loadModal('/frontend/registrant/disabled-cookies?iframe=1&lang='+$('html').attr('lang'))}})}}else if(!navigator.cookieEnabled){$.get('/frontend/registrant/disabled-cookies',function(result){$('body').prepend(result);$('#disabled-cookies-message .btn-close').on('click',function(){$('#disabled-cookies-message').slideUp()})})}},translate:function(key){try{return __TRANSLATIONS[key]}catch(err){return key}},disableButton:function(el,keepText){el.prop('disabled',!0);el.data('original-html',el.html());if(!keepText){var width=el.outerWidth();el.css('width',width+'px');el.html('<i class="fa fa-spinner fa-pulse"></i>')}
el.addClass('disabled')},reEnableButton:function(el){if(!el.hasClass('form-submission-blocked')){el.prop('disabled',!1);el.html(el.data('original-html'));el.removeClass('disabled')}},browserCookieId:function(appKey,channelId,sess,uid){if(typeof Pusher!=='function'){window.location='/'+eventSlug+'/sign-out?uid='+uid+'&reason=pusher'}
var pusher=new Pusher(appKey,{cluster:'eu'});var channel=pusher.subscribe(channelId);var currentSession=sess;channel.bind('check_login',function(data){var newSessionId=data.newSessionId;if(newSessionId!==currentSession){window.location='/'+eventSlug+'/sign-out?uid='+uid+'&reason=concurrent'}})},swoogoSessionLive:function(){$('.swoogo-session-live').each(function(){let el=$(this);if(el.data('on')){window.setTimeout(function(){el.removeClass('text-muted').addClass('text-success')},el.data('on'))}
if(el.data('off')){window.setTimeout(function(){el.removeClass('text-success').addClass('text-muted')},el.data('off'))}})},swoogoSessionOnDemand:function(){$('.swoogo-session-on-demand').each(function(){let el=$(this);if(el.data('on')){window.setTimeout(function(){el.removeClass('text-muted').addClass('text-success')},el.data('on'))}})},};var initDeviceCapture=function(){if($('#registrant-device')){getDevice();$(window).resize(getDevice)}};var initRegProgressNumbers=function(){renumberProgress();$(window).resize(renumberProgress)};var disableEnter=function(e){if(e.which===13){return!1}};var initShowDetails=function(){$('body').on('click','.show-details, .open-as-modal',function(e){e.preventDefault();EventScripts.loadModal($(this).attr('href'),$(this).attr('title'),($(this).data('size')?$(this).data('size'):'large'),!0)})};var getDevice=function(){var width=$(document).width();if(width<=768){$('#registrant-device').val('phone')}else if(width<992){$('#registrant-device').val('tablet')}else{$('#registrant-device').val('pc')}};var renumberProgress=function(){var countsteps=1;$('.steps > li').each(function(){if($(this).is(':visible')){$(this).find('.number').html(countsteps++)}})};var getWidgetIds=function(selector){var wIds='';$(selector).each(function(){wIds+=$(this).closest('.widget').attr('id').replace('w_','')+','});return wIds};var refreshWidgets=function(data){$.each(data,function(key,html){$(key).replaceWith(html)})};return pub}();jQuery(document).ready(function(){EventScripts.init()})