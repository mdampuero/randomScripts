var RegistrantInlineUpdates=function(){var dynamicClicks=[];var pub={init:function(){initInlineUpdates();initDiscountCode()},toggleBalanceDue:function(balanceDue){if(balanceDue>0){$('#registrant-payment_method').show();$('.no-balance-due').hide();$('.save-and-pay').each(function(){$(this).html($(this).data('with-fees'))})}else{$('#registrant-payment_method').hide();$('.no-balance-due').show();$('.save-and-pay').each(function(){$(this).html($(this).data('without-fees'))})}},initWaitlistToggle:function(){$('.waitlist-toggle .sw_input').on('change',function(){$(this).parents('.checkbox,.session').find('input.sw_waitlist').attr('disabled',$(this).prop('checked')).prop('checked',!1)});$('.waitlist-toggle .sw_waitlist').on('change',function(){$(this).parents('.radio').find('input.sw_input').attr('disabled',$(this).prop('checked')).prop('checked',!1)})},updateBillingAddress:function(){$.ajax({type:'POST',url:registrantUpdateUrl.replace('-action-','update-billing-address')+'&widgetIds='+getWidgetIds('.registrant-fees'),data:$('#billing-address-form').serialize(),success:function(data){if(data.success){if(data.widgets){refreshWidgets(data.widgets)}
if(data.address_id){$('#registrant-billing_address_id').val(data.address_id).trigger('change')}
if(data.address){$('.registrant-billing-address-div address').replaceWith(data.address)}
if(data.visibility){toggleVisibility(data.visibility)}
$.each(data.prices,function(index,value){$('.'+index).text(value)});$('#swoogo-modal').modal('hide')}},dataType:'JSON'})},reloadWidget:function(id){$.ajax({type:'POST',url:registrantUpdateUrl.replace('-action-','reload-widget')+'&widgetId='+id,data:$('#registrant-form,#cfs-form').serialize(),success:function(data){if(data.widgets){refreshWidgets(data.widgets)}},dataType:'JSON'})},handleVatNumber:function(e,el){let form=$('#registrant-form');let field=el.closest('.form-group');let code=field.find('.country-code');let input=field.find('.vat-number');let inputSalesperson=field.find('.vat-number-salespers');let helpBlock=field.find('.help-block');if(helpBlock.find('.fa-spin').length){return!1}
let action=(input.attr('disabled')?'remove':'apply');if(input.val()||inputSalesperson.val()){helpBlock.html('<i class="fa fa-spin fa-spinner"></i> '+(action==='remove'?'Removing':'Checking'));$.ajax({type:'POST',url:registrantUpdateUrl.replace('-action-','handle-vat-number'),data:form.serialize()+(action==='remove'?'&'+input.attr('name')+'=&'+inputSalesperson.attr('name')+'=':'')+($('.update-fees').length?'&refreshFees=true':''),context:el,success:function(data){if(data.success){field.removeClass('has-error');helpBlock.html(data.message);if(action==='apply'){if(code.length){code.multiselect('disable')}
input.attr('disabled','disabled');inputSalesperson.attr('disabled','disabled');el.html(el.data('remove-text'))}else{if(code.length){code.multiselect('enable')}
input.attr('disabled',!1).val('');inputSalesperson.attr('disabled',!1).val('');el.html(el.data('add-text'))}
if(data.widgets){refreshWidgets(data.widgets)}
$.each(data.prices,function(index,value){$('.'+index).text(value)});if(data.fees){$('.update-fees').each(function(){$(this).text(data.fees[$(this).data('fee')])})}
if(data.visibility){toggleVisibility(data.visibility)}}else if(data.message){field.addClass('has-error');helpBlock.html(data.message)}},dataType:'JSON'})}}};var initInlineUpdates=function(){$('#registrant-form,#registrant-update-form,#cfs-form,#registrant-waitlist-form').on('change','[data-inline-updates="true"]',evaluateInlineUpdates);$('.hide-parent').each(function(){hideParent($(this))});$('.swoogo-accordion').on('shown.bs.collapse',function(){$(this).find('.hide-parent').each(function(){hideParent($(this))})});$('.swoogo-tabs').on('shown.bs.tab',function(e){$(e.target).find('.hide-parent').each(function(){hideParent($(this))})});$('.hidden-default-selection').find(':input').each(storeOldValue);$('.hidden-dropdown-option').wrap('<span style="display:none;"></span>')};var evaluateInlineUpdates=function(e){var form=$(this).closest('form');var data='';if(e.originalEvent!==undefined){dynamicClicks=[]}
if($(e.target).hasClass('swoogo-no-refresh')){return!1}
var waitlistInput=$(e.target).closest('.waitlist-input');var visibilityField=(waitlistInput.length?waitlistInput.data('visibility-field'):$(this).data('visibility-field'));if(visibilityField){data+='&visibilityField='+visibilityField}
var refreshIds=getWidgetIds($(this).data('refresh-selector'));if(refreshIds){data+='&refreshIds='+refreshIds}
if($(this).data('refresh-fees')&&$('.update-fees').length){data+='&refreshFees=true'}
if($(this).data('conditional-fees')&&$('.conditional-fees').length){var conditionalFees=getWidgetIds('.conditional-fees');data+='&updateConditionalFees='+conditionalFees}
if(data.length>0&&typeof cfsUpdateUrl!=='undefined'){$.ajax({type:'POST',url:cfsUpdateUrl.replace('-action-','inline-updates'),data:form.serialize()+data,success:function(data){if(data.visibility){toggleVisibility(data.visibility)}
if(data.widgets){refreshWidgets(data.widgets)}},dataType:'JSON'})}else if(data.length>0&&typeof registrantUpdateUrl!=='undefined'){$.ajax({type:'POST',url:registrantUpdateUrl.replace('-action-','inline-updates'),data:form.serialize()+data,success:function(data){if(data.visibility){toggleVisibility(data.visibility)}
if(data.widgets){refreshWidgets(data.widgets)}
if(data.fees){$('.update-fees').each(function(){var fee=data.fees[$(this).data('fee')];$(this).text($(this).data('raw')?fee.replace(/[^\d.-]/g,''):fee)})}},dataType:'JSON'})}};var getWidgetIds=function(selector){var wIds='';$(selector).each(function(){wIds+=$(this).closest('.widget').attr('id').replace('w_','')+','});return wIds};var toggleVisibility=function(data){var handleSingleRadioParents;$.each(data,function(key,display){var el=$('.'+key);var input=el.find(':input');var parent=el.closest('.hide-parent');if(el.hasClass('swoogo-form')){if(!el.hasClass('admin-reg')){if(display==='visible'){$('button[type="submit"]').each(function(){$(this).removeClass('form-submission-blocked');EventScripts.reEnableButton($(this))})}else{$('button[type="submit"]').each(function(){$(this).addClass('form-submission-blocked');EventScripts.disableButton($(this),!0)})}}}else if(display==='visible'&&el.hasClass('hidden')){if(dynamicClicks[key]!==1){input.each(restoreOldValue);if(!el.hasClass('page')){dynamicClicks[key]=1}}
if(el.is('option')&&el.parent().is('span')){el.removeClass('hidden-dropdown-option').unwrap()}
el.removeClass('hidden').hide();el.fadeIn('fast',function(){if(parent.length){parent.removeClass('hidden')}
el.closest('.widget-api').trigger('updated.pageWidget')});if(parent.length){handleSingleRadioParents=!0}}else if(display!=='visible'&&!el.hasClass('hidden')){el.fadeOut('fast',function(){if(dynamicClicks[key]!==1){input.each(storeOldValue);if(!el.hasClass('page')){dynamicClicks[key]=1}}
if(el.is('option')){el.wrap('<span style="display:none;"></span>')}
el.addClass('hidden');if(parent.length){hideParent(parent)}
el.closest('.widget-api').trigger('updated.pageWidget')})}});if(handleSingleRadioParents){$('.hide-parent').each(function(){singleRadio($(this))})}};var storeOldValue=function(){var type=$(this).attr('type');var currentVal;if(type==='submit'){return!1}else if(type==='checkbox'||type==='radio'){$(this).data('old-value',$(this).prop('checked'));$(this).prop('checked',!1);currentVal=$(this).prop('checked')}else{$(this).data('old-value',$(this).val());$(this).val('');currentVal=$(this).val()}
if($(this).data('old-value')!==currentVal){$(this).trigger('change')}};var restoreOldValue=function(){var name=$(this).attr('name');skipNames=['DateInputs[]','TimeInputs[]'];if(skipNames.indexOf(name)>=0){return}
var type=$(this).attr('type');var previousVal,restoreVal;if(type==='submit'){return!1}else if(type==='checkbox'||type==='radio'){previousVal=$(this).prop('checked');restoreVal=(typeof $(this).data('old-value')!=='undefined'?$(this).data('old-value'):!1);$(this).prop('checked',restoreVal)}else{previousVal=$(this).val();restoreVal=(typeof $(this).data('old-value')!=='undefined'?$(this).data('old-value'):'');$(this).val(restoreVal)}
if(previousVal!==restoreVal){$(this).trigger('change')}};var hideParent=function(parent){if(parent.hasClass('has-error')||parent.closest(".panel-collapse.collapse:not(.in)").length>0||parent.closest(".tab-pane:not(.active)").length>0||parent.closest(".page.panel.hidden").length>0){return}
var visibleOptions;if(parent.find('select').not('.session-filter').length){visibleOptions=(parent.find('option').not('.hidden').length-1)}else{visibleOptions=parent.find('input:visible').not('.check-all').length;parent.find('input.fake-visible').each(function(){if($(this).val()){visibleOptions++}});singleRadio(parent)}
if(!visibleOptions){parent.addClass('hidden')}};var singleRadio=function(parent){if(parent.find('.radio').not('.hidden').length===1){if(!parent.hasClass('single-radio')){parent.addClass('single-radio');parent.find('.radio').not('.hidden').find('input').prop('checked',!0).trigger('change')}}else{parent.removeClass('single-radio')}};var refreshWidgets=function(data){$.each(data,function(key,html){$(key).replaceWithJS(html).done(function(){$(key).find('.hide-parent').each(function(){hideParent($(this))});$(key).trigger('updated.pageWidget')})})};var initDiscountCode=function(){$('.field-registrant-discount_code .btn').on('click',function(e){if($(this).hasClass('remove')){removeDiscount(e,$(this))}else{applyDiscount(e,$(this))}});$('.field-registrant-discount_code .form-control').on('blur',function(){$(this).closest('.form-group').find('.btn').trigger('click')})};let applyDiscount=function(e,el){let form=$('#registrant-form');let field=el.closest('.form-group');let input=field.find('.form-control');let helpBlock=field.find('.help-block');if(helpBlock.find('.fa-spin').length>0){return!1}
helpBlock.html('<i class="fa fa-spin fa-spinner"></i> '+field.find('.btn').data('checking-text'));if(input.val().length>0){$.ajax({type:'POST',url:registrantUpdateUrl.replace('-action-','apply-discount')+(el.data('reg-id')?'&cid='+el.data('reg-id'):''),data:form.serialize()+($('.update-fees').length?'&refreshFees=true':''),context:el,success:function(data){if(data.success){field.removeClass('has-error').addClass('has-success');helpBlock.html(data.message);$.each(data.widgets,function(index,value){$(index).replaceWith(value)});$.each(data.prices,function(index,value){$('.'+index).text(value)});if(data.fees){$('.update-fees').each(function(){$(this).text(data.fees[$(this).data('fee')])})}
$(input).after('<input type="hidden" id="hidden-discount-code" name="'+$(input).attr('name')+'" value="'+$(input).val()+'" />');$(input).attr('disabled','disabled');el.addClass('remove');el.html(el.data('remove-text'));if(data.visibility){toggleVisibility(data.visibility)}
$('.hide-parent').each(function(){hideParent($(this))});$('body').trigger('swoogo-discount-applied')}else{field.addClass('has-error');helpBlock.html(data.message);$('body').trigger('swoogo-discount-invalid')}},dataType:'JSON'})}else{field.removeClass('has-error');helpBlock.html('')}};let removeDiscount=function(e,el){let form=$('#registrant-form');let field=el.closest('.form-group');let input=field.find('.form-control');let helpBlock=field.find('.help-block');if(helpBlock.find('.fa-spin').length){return!1}
helpBlock.html('<i class="fa fa-spin fa-spinner"></i> '+field.find('.btn').data('removing-text'));if(input.val().length>0){$.ajax({type:'POST',url:registrantUpdateUrl.replace('-action-','remove-discount')+(el.data('reg-id')?'&cid='+el.data('reg-id'):''),data:form.serialize()+($('.update-fees').length?'&refreshFees=true':''),context:el,success:function(data){field.removeClass('has-error has-success');helpBlock.html('');$('#hidden-discount-code').remove();$(input).attr('disabled',!1).val('');el.removeClass('remove');el.html(el.data('add-text'));$.each(data.widgets,function(index,value){$(index).replaceWith(value)});$.each(data.prices,function(index,value){$('.'+index).text(value)});if(data.fees){$('.update-fees').each(function(){$(this).text(data.fees[$(this).data('fee')])})}
if(data.visibility){toggleVisibility(data.visibility)}
$('.hide-parent').each(function(){hideParent($(this))})},dataType:'JSON'})}else{field.removeClass('has-error');helpBlock.html('')}};return pub}();jQuery(document).ready(function(){RegistrantInlineUpdates.init()})